{% extends 'base.html' %}

{% block title %}Nova Solicitação{% endblock %}

{% block content %}
<div class="container-fluid">
  <h1 class="mb-4">Nova Solicitação</h1>

  <form method="post" action="{% url 'solicitacoes:criar_solicitacao' %}">
    {% csrf_token %}
    
    <div class="mb-3">
      <label for="solicitante_nome" class="form-label">Nome do Solicitante</label>
      <input type="text" class="form-control" id="solicitante_nome" name="solicitante_nome" required>
    </div>

    <div class="mb-3">
      <label for="programar_para" class="form-label">Programar Para (Data)</label>
      <input type="date" class="form-control" id="programar_para" name="programar_para">
    </div>

    <hr>
    <h3>Itens da Solicitação</h3>
    <div id="itens-container">
      <div class="item row mb-3">
        <div class="col-md-3">
          <input type="text" name="aplicacao_0" class="form-control" placeholder="Aplicação" required>
        </div>
        <div class="col-md-3">
          <input type="text" name="descricao_0" class="form-control" placeholder="Descrição" required>
        </div>
        <div class="col-md-3">
          <input type="text" name="especificacao_0" class="form-control" placeholder="Especificação">
        </div>
        <div class="col-md-2">
          <input type="number" name="quantidade_0" class="form-control" placeholder="Quantidade" min="1" required>
        </div>
        <div class="col-md-1">
          <button type="button" class="btn btn-danger btn-remove-item">X</button>
        </div>
      </div>
    </div>

    <button type="button" id="add-item-btn" class="btn btn-secondary mb-3">Adicionar Item</button>

    <br>

    <button type="submit" class="btn btn-primary">Salvar Solicitação</button>
    <a href="{% url 'solicitacoes:index' %}" class="btn btn-secondary">Cancelar</a>
  </form>
</div>

<script>
  (function() {
    let itemIndex = 1;

    const container = document.getElementById('itens-container');
    const addBtn = document.getElementById('add-item-btn');

    addBtn.addEventListener('click', function() {
      const div = document.createElement('div');
      div.classList.add('item', 'row', 'mb-3');

      div.innerHTML = `
        <div class="col-md-3">
          <input type="text" name="aplicacao_${itemIndex}" class="form-control" placeholder="Aplicação" required>
        </div>
        <div class="col-md-3">
          <input type="text" name="descricao_${itemIndex}" class="form-control" placeholder="Descrição" required>
        </div>
        <div class="col-md-3">
          <input type="text" name="especificacao_${itemIndex}" class="form-control" placeholder="Especificação">
        </div>
        <div class="col-md-2">
          <input type="number" name="quantidade_${itemIndex}" class="form-control" placeholder="Quantidade" min="1" required>
        </div>
        <div class="col-md-1">
          <button type="button" class="btn btn-danger btn-remove-item">X</button>
        </div>
      `;

      container.appendChild(div);

      itemIndex++;

      // Botão remover
      div.querySelector('.btn-remove-item').addEventListener('click', function() {
        container.removeChild(div);
      });
    });

    // Remover itens iniciais
    container.querySelectorAll('.btn-remove-item').forEach(function(btn) {
      btn.addEventListener('click', function(event) {
        const itemDiv = event.target.closest('.item');
        container.removeChild(itemDiv);
      });
    });
  })();
</script>
{% endblock %}
